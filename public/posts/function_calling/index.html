<!doctype html><html lang=en dir=auto><head><script src="/site/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=site/livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>introduction to openai function calling | xie</title>
<meta name=keywords content="machine learning,python,tutorials"><meta name=description content="Key Topics OpenAI Function Calls State Handling API Integration Abstract q: what is the uuid of the player merrydith? Question: How can my code respond to human like speech input?
This project is a demonstration on how a large language model can access information outside of the data set it was trained on. OpenAI has added the capability to create functions (ex. accessing mojang api) and call respective functions when the language model sees fit."><meta name=author content="daniel"><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/site/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/site/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/site/favicon.ico><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/site/favicon.ico><link rel=apple-touch-icon href=http://localhost:1313/site/favicon.ico><link rel=mask-icon href=http://localhost:1313/site/favicon.ico><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/site/posts/function_calling/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="introduction to openai function calling"><meta property="og:description" content="Key Topics OpenAI Function Calls State Handling API Integration Abstract q: what is the uuid of the player merrydith? Question: How can my code respond to human like speech input?
This project is a demonstration on how a large language model can access information outside of the data set it was trained on. OpenAI has added the capability to create functions (ex. accessing mojang api) and call respective functions when the language model sees fit."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/site/posts/function_calling/"><meta property="og:image" content="http://localhost:1313/site/%3Cimage%20path/url%3E"><meta property="article:section" content="posts"><meta property="og:site_name" content="xie"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/site/%3Cimage%20path/url%3E"><meta name=twitter:title content="introduction to openai function calling"><meta name=twitter:description content="Key Topics OpenAI Function Calls State Handling API Integration Abstract q: what is the uuid of the player merrydith? Question: How can my code respond to human like speech input?
This project is a demonstration on how a large language model can access information outside of the data set it was trained on. OpenAI has added the capability to create functions (ex. accessing mojang api) and call respective functions when the language model sees fit."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/site/posts/"},{"@type":"ListItem","position":2,"name":"introduction to openai function calling","item":"http://localhost:1313/site/posts/function_calling/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"introduction to openai function calling","name":"introduction to openai function calling","description":"Key Topics OpenAI Function Calls State Handling API Integration Abstract q: what is the uuid of the player merrydith? Question: How can my code respond to human like speech input?\nThis project is a demonstration on how a large language model can access information outside of the data set it was trained on. OpenAI has added the capability to create functions (ex. accessing mojang api) and call respective functions when the language model sees fit.","keywords":["machine learning","python","tutorials"],"articleBody":"Key Topics OpenAI Function Calls State Handling API Integration Abstract q: what is the uuid of the player merrydith? Question: How can my code respond to human like speech input?\nThis project is a demonstration on how a large language model can access information outside of the data set it was trained on. OpenAI has added the capability to create functions (ex. accessing mojang api) and call respective functions when the language model sees fit.\nMore importantly, it shows how a language model can process natural language into a format that API’s and computers can recognize. It allows us humans to communicate as a human to our code. Think about those AI chatbots on shopping stores. They 100% use the idea discussed in this article.\nGoal Say I type a sentence asking, \"what is the id of this player?\" to a python script. It would store the input in some variable, and try to pass it into an API that gets the id. However, the API would recieve the entire sentence, which would result in an error because the sentence is NOT a valid username.\nIf only there was a way to extract ONLY the username out of the sentence, and then pass it into the API…\nThere is! OpenAI and most high end language models offer a strategy called function calling, which is better explained here. This article is just an example you can try once you get an understanding of what function calling is.\nqueued The request is queued for processing. This status indicates that the process has started but has not yet begun extracting the relevant data. in_progress The processing of the request is now in progress. At this stage, the script is actively working to extract the username from the provided sentence. requires_action This status typically indicates that additional input or confirmation may be needed; however, in this automated process, it proceeds swiftly to the next step. completed The process is completed, and the UUID has been successfully retrieved. Here is what the complete chain of events looks like: q: what is the id of the player merrydith \"status\": \"queued\", \"status\": \"in_progress\", Function Calling {'tool_calls': [{'id': 'merrydith', 'function': {'arguments': '{\\n \"username\": \"merrydith\"\\n}', 'name': 'get_uuid_from_username'}, 'type': 'function'}]} Submitting outputs back to the Assistant... \"status\": \"requires_action\", \"status\": \"in_progress\", \"status\": \"completed\", Assistant: The id for \"merrydith\" is 4e0b33ffc796431aa99253626e33d4a6. Code from openai import OpenAI import time import os from dotenv import load_dotenv import requests load_dotenv() openai = os.getenv('OPENAI_API_KEY') hypixel = os.getenv('HYPIXEL_API_KEY') prompt = input(\"q: \") #------------FUNCTIONS-----------------# def get_uuid_from_username(username: str) -\u003e str: url = \"https://api.mojang.com/users/profiles/minecraft/{username}\" response = requests.get(url.format(username=username)) if response.status_code == 200: data = response.json() uuid = data.get(\"id\") return uuid else: return \"error\" #------------TOOLS and CLIENT-----------------# tools_list = [{ \"type\": \"function\", \"function\": { \"name\": \"get_uuid_from_username\", \"description\": \"Retrieve the UUID given a minecraft username.\", \"parameters\": { \"type\": \"object\", \"properties\": { \"username\": { \"type\": \"string\", \"description\": \"The minecraft username.\" } }, \"required\": [\"username\"] } } }] client = OpenAI(api_key=openai) #create assistant assistant = client.beta.assistants.create( name=\"daniels assistant\", instructions=\"You are a personal assistant that caters to any task.\", tools=tools_list, model=\"gpt-3.5-turbo-0613\", ) #create thread thread = client.beta.threads.create() #add msg to thread message = client.beta.threads.messages.create( thread_id=thread.id, role=\"user\", content=prompt ) #run the assistant run = client.beta.threads.runs.create( thread_id=thread.id, assistant_id=assistant.id, instructions=\"Please address the user as Johnny Appleseed\" ) print(run.model_dump_json(indent=4)) while True: time.sleep(1) #retrieve the run status run_status = client.beta.threads.runs.retrieve( thread_id=thread.id, run_id=run.id ) print(run_status.model_dump_json(indent=4)) # If run is completed, get messages if run_status.status == 'completed': messages = client.beta.threads.messages.list( thread_id=thread.id ) # Loop through messages and print content based on role for msg in messages.data: role = msg.role content = msg.content[0].text.value print(f\"{role.capitalize()}: {content}\") break elif run_status.status == 'requires_action': print(\"Function Calling\") required_actions = run_status.required_action.submit_tool_outputs.model_dump() print(required_actions) tool_outputs = [] import json for action in required_actions[\"tool_calls\"]: func_name = action['function']['name'] arguments = json.loads(action['function']['arguments']) if func_name == \"get_uuid_from_username\": output = get_uuid(username=arguments['username']) tool_outputs.append({ \"tool_call_id\": action['id'], \"output\": output }) else: raise ValueError(f\"Unknown function: {func_name}\") print(\"Submitting outputs back to the Assistant...\") client.beta.threads.runs.submit_tool_outputs( thread_id=thread.id, run_id=run.id, tool_outputs=tool_outputs ) else: print(\"Waiting for the Assistant to process...\") time.sleep(1) ","wordCount":"654","inLanguage":"en","image":"http://localhost:1313/site/%3Cimage%20path/url%3E","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"daniel"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/site/posts/function_calling/"},"publisher":{"@type":"Organization","name":"xie","logo":{"@type":"ImageObject","url":"http://localhost:1313/site/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/site/ accesskey=h title="dx (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>dx</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/site/tags/ title=projects><span>projects</span></a></li><li><a href=http://localhost:1313/site/categories/ title=categories><span>categories</span></a></li><li><a href=http://localhost:1313/site/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/site/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/site/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">introduction to openai function calling</h1><div class=post-meta>daniel&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/function_calling.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#abstract>Abstract</a></li><li><a href=#goal>Goal</a><ul><li><a href=#here-is-what-the-complete-chain-of-events-looks-like>Here is what the complete chain of events looks like:</a></li></ul></li><li><a href=#code>Code</a></li></ul></nav></div></details></div><div class=post-content><h1 id=key-topics>Key Topics<a hidden class=anchor aria-hidden=true href=#key-topics>#</a></h1><ul><li><a href=https://platform.openai.com/docs/guides/function-calling><strong>OpenAI Function Calls</strong></a></li><li><strong>State Handling</strong></li><li><strong>API Integration</strong></li></ul><h2 id=abstract>Abstract<a hidden class=anchor aria-hidden=true href=#abstract>#</a></h2><pre tabindex=0><code class=language-a data-lang=a>q: what is the uuid of the player merrydith?
</code></pre><p><code>Question: How can my code respond to human like speech input?</code></p><p>This project is a demonstration on how a large language model can access information outside of the data set it was trained on. OpenAI has added the capability to create functions (ex. accessing mojang api) and call respective functions when the language model sees fit.</p><p><strong>More importantly</strong>, it shows how a language model can process natural language into a format that API&rsquo;s and computers can recognize. It <em>allows</em> us humans to communicate as a <strong>human</strong> to our code. Think about those AI chatbots on shopping stores. They 100% use the idea discussed in this article.</p><h2 id=goal>Goal<a hidden class=anchor aria-hidden=true href=#goal>#</a></h2><p>Say I type a sentence asking, <code>"what is the id of this player?"</code> to a python script. It would store the input in some variable, and try to pass it into an API that gets the id. However, the API would recieve the entire sentence, which would result in an error because the sentence is <strong>NOT</strong> a valid username.</p><p>If only there was a way to extract ONLY the username out of the sentence, and then pass it into the API&mldr;</p><p>There is! OpenAI and most high end language models offer a strategy called <code>function calling</code>, which is better explained <a href=https://platform.openai.com/docs/guides/function-calling>here.</a> This article is just an example you can try once you get an understanding of what function calling is.</p><ul><li><code>queued</code> The request is queued for processing. This status indicates that the process has started but has not yet begun extracting the relevant data.</li><li><code>in_progress</code> The processing of the request is now in progress. At this stage, the script is actively working to extract the username from the provided sentence.</li><li><code>requires_action</code> This status typically indicates that additional input or confirmation may be needed; however, in this automated process, it proceeds swiftly to the next step.</li><li><code>completed</code> The process is completed, and the UUID has been successfully retrieved.</li></ul><h3 id=here-is-what-the-complete-chain-of-events-looks-like>Here is what the complete chain of events looks like:<a hidden class=anchor aria-hidden=true href=#here-is-what-the-complete-chain-of-events-looks-like>#</a></h3><pre tabindex=0><code class=language-a data-lang=a>q: what is the id of the player merrydith
</code></pre><pre tabindex=0><code class=language-a data-lang=a> &#34;status&#34;: &#34;queued&#34;,
</code></pre><pre tabindex=0><code class=language-a data-lang=a>&#34;status&#34;: &#34;in_progress&#34;,
</code></pre><pre tabindex=0><code class=language-a data-lang=a>Function Calling
{&#39;tool_calls&#39;: [{&#39;id&#39;: &#39;merrydith&#39;, &#39;function&#39;: {&#39;arguments&#39;: &#39;{\n  &#34;username&#34;: &#34;merrydith&#34;\n}&#39;, &#39;name&#39;: &#39;get_uuid_from_username&#39;}, &#39;type&#39;: &#39;function&#39;}]}
Submitting outputs back to the Assistant...
</code></pre><pre tabindex=0><code class=language-a data-lang=a>&#34;status&#34;: &#34;requires_action&#34;,
</code></pre><pre tabindex=0><code class=language-a data-lang=a>&#34;status&#34;: &#34;in_progress&#34;,
</code></pre><pre tabindex=0><code class=language-a data-lang=a>&#34;status&#34;: &#34;completed&#34;,
</code></pre><pre tabindex=0><code class=language-a data-lang=a>Assistant: The id for &#34;merrydith&#34; is 4e0b33ffc796431aa99253626e33d4a6.
</code></pre><h2 id=code>Code<a hidden class=anchor aria-hidden=true href=#code>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>openai</span> <span class=kn>import</span> <span class=n>OpenAI</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dotenv</span> <span class=kn>import</span> <span class=n>load_dotenv</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>load_dotenv</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>openai</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>&#39;OPENAI_API_KEY&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>hypixel</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>getenv</span><span class=p>(</span><span class=s1>&#39;HYPIXEL_API_KEY&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>prompt</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&#34;q: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#------------FUNCTIONS-----------------#</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_uuid_from_username</span><span class=p>(</span><span class=n>username</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;https://api.mojang.com/users/profiles/minecraft/</span><span class=si>{username}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>username</span><span class=o>=</span><span class=n>username</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>uuid</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;id&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>uuid</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;error&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#------------TOOLS and CLIENT-----------------#</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>tools_list</span> <span class=o>=</span> <span class=p>[{</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>        <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;function&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;function&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;get_uuid_from_username&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;Retrieve the UUID given a minecraft username.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;parameters&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;object&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;properties&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;username&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;type&#34;</span><span class=p>:</span> <span class=s2>&#34;string&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=s2>&#34;description&#34;</span><span class=p>:</span> <span class=s2>&#34;The minecraft username.&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;required&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;username&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=p>}]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>OpenAI</span><span class=p>(</span><span class=n>api_key</span><span class=o>=</span><span class=n>openai</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#create assistant</span>
</span></span><span class=line><span class=cl><span class=n>assistant</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>assistants</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span><span class=o>=</span><span class=s2>&#34;daniels assistant&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>instructions</span><span class=o>=</span><span class=s2>&#34;You are a personal assistant that caters to any task.&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tools</span><span class=o>=</span><span class=n>tools_list</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>model</span><span class=o>=</span><span class=s2>&#34;gpt-3.5-turbo-0613&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#create thread</span>
</span></span><span class=line><span class=cl><span class=n>thread</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>create</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#add msg to thread</span>
</span></span><span class=line><span class=cl><span class=n>message</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>thread_id</span><span class=o>=</span><span class=n>thread</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>role</span><span class=o>=</span><span class=s2>&#34;user&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>content</span><span class=o>=</span><span class=n>prompt</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#run the assistant</span>
</span></span><span class=line><span class=cl><span class=n>run</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>runs</span><span class=o>.</span><span class=n>create</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>thread_id</span><span class=o>=</span><span class=n>thread</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>assistant_id</span><span class=o>=</span><span class=n>assistant</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>instructions</span><span class=o>=</span><span class=s2>&#34;Please address the user as Johnny Appleseed&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>run</span><span class=o>.</span><span class=n>model_dump_json</span><span class=p>(</span><span class=n>indent</span><span class=o>=</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>#retrieve the run status</span>
</span></span><span class=line><span class=cl>    <span class=n>run_status</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>runs</span><span class=o>.</span><span class=n>retrieve</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>thread_id</span><span class=o>=</span><span class=n>thread</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>run_id</span><span class=o>=</span><span class=n>run</span><span class=o>.</span><span class=n>id</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>run_status</span><span class=o>.</span><span class=n>model_dump_json</span><span class=p>(</span><span class=n>indent</span><span class=o>=</span><span class=mi>4</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># If run is completed, get messages</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>run_status</span><span class=o>.</span><span class=n>status</span> <span class=o>==</span> <span class=s1>&#39;completed&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>messages</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>messages</span><span class=o>.</span><span class=n>list</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>thread_id</span><span class=o>=</span><span class=n>thread</span><span class=o>.</span><span class=n>id</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># Loop through messages and print content based on role</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>msg</span> <span class=ow>in</span> <span class=n>messages</span><span class=o>.</span><span class=n>data</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>role</span> <span class=o>=</span> <span class=n>msg</span><span class=o>.</span><span class=n>role</span>
</span></span><span class=line><span class=cl>            <span class=n>content</span> <span class=o>=</span> <span class=n>msg</span><span class=o>.</span><span class=n>content</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>text</span><span class=o>.</span><span class=n>value</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>role</span><span class=o>.</span><span class=n>capitalize</span><span class=p>()</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>content</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>run_status</span><span class=o>.</span><span class=n>status</span> <span class=o>==</span> <span class=s1>&#39;requires_action&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Function Calling&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>required_actions</span> <span class=o>=</span> <span class=n>run_status</span><span class=o>.</span><span class=n>required_action</span><span class=o>.</span><span class=n>submit_tool_outputs</span><span class=o>.</span><span class=n>model_dump</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>required_actions</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>tool_outputs</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>action</span> <span class=ow>in</span> <span class=n>required_actions</span><span class=p>[</span><span class=s2>&#34;tool_calls&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=n>func_name</span> <span class=o>=</span> <span class=n>action</span><span class=p>[</span><span class=s1>&#39;function&#39;</span><span class=p>][</span><span class=s1>&#39;name&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>arguments</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>action</span><span class=p>[</span><span class=s1>&#39;function&#39;</span><span class=p>][</span><span class=s1>&#39;arguments&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>func_name</span> <span class=o>==</span> <span class=s2>&#34;get_uuid_from_username&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>output</span> <span class=o>=</span> <span class=n>get_uuid</span><span class=p>(</span><span class=n>username</span><span class=o>=</span><span class=n>arguments</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=n>tool_outputs</span><span class=o>.</span><span class=n>append</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;tool_call_id&#34;</span><span class=p>:</span> <span class=n>action</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=s2>&#34;output&#34;</span><span class=p>:</span> <span class=n>output</span>
</span></span><span class=line><span class=cl>                <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Unknown function: </span><span class=si>{</span><span class=n>func_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Submitting outputs back to the Assistant...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>client</span><span class=o>.</span><span class=n>beta</span><span class=o>.</span><span class=n>threads</span><span class=o>.</span><span class=n>runs</span><span class=o>.</span><span class=n>submit_tool_outputs</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=n>thread_id</span><span class=o>=</span><span class=n>thread</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>run_id</span><span class=o>=</span><span class=n>run</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>tool_outputs</span><span class=o>=</span><span class=n>tool_outputs</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Waiting for the Assistant to process...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/site/tags/machine-learning/>Machine Learning</a></li><li><a href=http://localhost:1313/site/tags/python/>Python</a></li><li><a href=http://localhost:1313/site/tags/tutorials/>Tutorials</a></li></ul><nav class=paginav><a class=prev href=http://localhost:1313/site/posts/linter/><span class=title>« Prev</span><br><span>fixing code style with style</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=http://localhost:1313/site/>xie</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>